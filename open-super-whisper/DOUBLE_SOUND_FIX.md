# 録音開始時の二重起動音問題修正 🔧

## 問題の概要
録音開始のショートカットキーを押した時に、起動音が二重に再生される問題が発生していました。

## 原因分析
1. **ホットキーの重複実行**: 同じホットキーが短時間に複数回検出される
2. **録音開始処理の重複実行**: 既に録音中の状態でも録音開始処理が実行される
3. **音声再生の重複**: 既に再生中の音声に対して新しい再生が開始される

## 修正内容

### 1. ホットキーマネージャーの修正 (`src/core/hotkeys.py`)
- **重複実行防止機能を追加**
  - 最後に実行されたホットキーとその時刻を記録
  - 0.5秒間の重複実行を防止
  - デバッグログで重複実行の検出を確認可能

```python
# 重複実行防止のための変数
self._last_executed_hotkey = None
self._last_execution_time = 0
self._debounce_time = 0.5  # 0.5秒間の重複実行を防ぐ
```

### 2. 録音開始処理の修正 (`src/gui/windows/main_window.py`)
- **録音状態チェックを追加**
  - 既に録音中の場合は処理をスキップ
  - 重複実行のログ出力

```python
# 既に録音中の場合は処理をスキップ
if self.is_recording:
    print("[Recording] 既に録音中のため、重複実行をスキップ")
    return
```

### 3. 音声再生処理の修正 (`src/gui/windows/main_window.py`)
- **重複再生防止機能を追加**
  - 既に再生中の場合は停止してから再生
  - 各音声再生メソッドに重複チェックを実装

```python
# 既に再生中の場合は停止してから再生
if self.start_player.playbackState() == QMediaPlayer.PlaybackState.PlayingState:
    self.start_player.stop()
    print("[Sound] 既存の開始音を停止してから再生")
```

## 修正効果
- ✅ ホットキーの重複実行を防止
- ✅ 録音開始処理の重複実行を防止
- ✅ 音声の重複再生を防止
- ✅ デバッグログで問題の追跡が可能

## テスト方法
1. 録音開始のショートカットキーを素早く複数回押す
2. コンソールログで重複実行の防止を確認
3. 音声が一度だけ再生されることを確認

## 技術的詳細
- **デバウンス時間**: 0.5秒（必要に応じて調整可能）
- **状態管理**: 録音状態と音声再生状態の二重チェック
- **ログ出力**: 問題の追跡とデバッグを支援

この修正により、録音開始時の二重起動音問題が解決されます。🎵 